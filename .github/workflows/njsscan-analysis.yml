# This workflow integrates njsscan with GitHub's Code Scanning feature
# nodejsscan is a static security code scanner that finds insecure code patterns in your Node.js applications

name: njsscan sarif

on: 
  push:
  pull_request:
  schedule:
    - cron: '0, 0, 1,15,30, *, *'
  workflow_dispatch:

jobs:

  njsscan:
    runs-on: ubuntu-latest
    name: njsscan code scanning
    
    steps:
    - name: Checkout the code
      uses: actions/checkout@v2
      
    - name: nodejsscan scan
      id: njsscan
      uses: ajinabraham/njsscan-action@master
      with:
        args: '. --sarif --output results.sarif || true'
        
  npmEnvironment:
   strategy:
    matrix:
     node-version: ['12.1', 12.x, '14.1', 14,x]
     platform: 
      - os: ubuntu-latest
        shell: bash  
      - os: windows-latest
        shell: bash 
      - os: windows-latest
        shell: powershell
        
   runs-on: ${{ matrix.platform.os }}
   defaults:
    run:
     shell: ${{ matrix.platform.shell }}
          
    
    
   steps:
    - uses: actions/checkout@v2 
     
    - uses: actions/setup-node@v2
      with:
       node-version: ${{ matrix.platform.shell }}
        
    - name: npm install and analyze
      run: |
       npm install
       npm doctor
       npm build 
      env:
       GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
       DEPLOY_VERSION: testing
       
    
    - name: Upload njsscan report
      uses: github/codeql-action/upload-sarif@v1
      with:
       sarif_file: results.sarif
